@model dynamic
@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Historial del Paciente</title>

    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            font-family: Arial, sans-serif;
            font-size: 16px;
            color: #000;
            line-height: 1.6;
        }

        .header-table {
            width: 100%;
            border-bottom: 3px solid #8B0000;
            margin-bottom: 30px;
        }

            .header-table td {
                vertical-align: middle;
            }

        .logo {
            max-width: 150px;
        }

        .lab-name {
            font-size: 28px;
            font-weight: bold;
            color: #8B0000;
        }

        h1 {
            color: #8B0000;
            text-align: center;
            margin-top: 20px;
            margin-bottom: 30px;
            font-size: 26px;
        }

        .section-title {
            font-weight: bold;
            color: #8B0000;
            margin-top: 30px;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .info-list {
            list-style: none;
            padding-left: 0;
        }

            .info-list li {
                margin-bottom: 6px;
            }

        table.table {
            font-size: 14px;
            margin-bottom: 30px;
        }

        thead {
            background-color: #8B0000;
            color: #fff;
        }

        tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            font-size: 12px;
            color: #888;
        }

        .estado {
            font-weight: bold;
            font-size: 18px;
            color: #8B0000;
            margin-bottom: 20px;
        }

        hr {
            border-top: 2px solid #8B0000;
            margin-top: 40px;
            margin-bottom: 40px;
        }
    </style>
</head>
<body>
    <!-- Encabezado -->
    <table class="header-table">
        <tr>
            <td style="width: 180px;">
                <img src="~/imagenes/logo.jpg" alt="Logo del Laboratorio" class="logo" />
            </td>
            <td>
                <div class="lab-name">Laboratorio Clínico OMYLAB</div>
                <div style="color: #333; font-size: 16px;">Confianza y precisión en cada resultado</div>
            </td>
        </tr>
    </table>

    <!-- Título principal -->
    <h1>Historial de @Model.Paciente.Nombre @Model.Paciente.Apellidos</h1>

    <!-- Datos del Paciente -->
    <div class="section-title">Datos del Paciente</div>
    <ul class="info-list">
        <li><strong>DNI:</strong> @Model.Paciente.Dni</li>
        <li><strong>Sexo:</strong> @Model.Paciente.Sexo</li>
        <li><strong>Edad:</strong> @Model.Paciente.Edad años</li>
    </ul>
    <!-- Verificar si tiene análisis -->
    @if (Model.ListaAnalisis != null && Model.ListaAnalisis.Count == 0)

{
    <div class="alert alert-warning" role="alert" style="border: 1px solid #8B0000; background-color: #fff3cd; color: #856404; font-size: 18px; margin-top: 30px;">
        <strong>Atención:</strong> Este paciente aún no tiene análisis registrados.
    </div>
}
else
{
    <!-- Iterar cada Análisis -->
    @foreach (var item in Model.ListaAnalisis)
    {
        <hr />
        <h2>@item.Analisis.Nombre</h2>

        <div class="estado">
            Estado: @item.AnalisisPaciente.Estado
        </div>

        @if (item.AnalisisPaciente.Estado == "completado")
        {
            <div class="section-title">Datos del Análisis</div>
            <ul class="info-list">
                <li><strong>Tipo de Muestra:</strong> @item.Analisis.TipoMuestra</li>
                <li><strong>Fecha y Hora de Registro:</strong> @item.AnalisisPaciente.FechaHoraRegistro</li>
                <li><strong>Fecha de Registro del Resultado:</strong> @item.Resultado.FechaRegistro</li>
            </ul>

            <div class="section-title">Detalle de Componentes</div>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Componente</th>
                        <th>Valor Resultado</th>
                        <th>Resultado</th>
                        <th>Valor Mínimo</th>
                        <th>Valor Máximo</th>
                        <th>Unidad</th>
                        <th>Sexo</th>
                        <th>Edad Mínima</th>
                        <th>Edad Máxima</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var comp in item.Componentes)
                    {
                        foreach (var refVal in comp.Referencias)
                        {
                            <tr>
                                <td>@comp.NombreComponente</td>
                                <td>@comp.ValorResultado</td>
                                <td>@comp.Resultado</td>
                                <td>@refVal.ValorMinimo</td>
                                <td>@refVal.ValorMaximo</td>
                                <td>@refVal.Unidad</td>
                                <td>@refVal.Sexo</td>
                                <td>@(refVal.EdadMinima?.ToString() ?? "N/A")</td>
                                <td>@(refVal.EdadMaxima?.ToString() ?? "N/A")</td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        }
        else if (item.AnalisisPaciente.Estado == "Pendiente")
        {
            <p><em>Este análisis se encuentra registrado pero está a la espera de resultados.</em></p>
        }
        else if (item.AnalisisPaciente.Estado == "Cancelado")
        {
            <p><em>Este análisis fue cancelado por el paciente, no se muestran resultados.</em></p>
        }
    }
    }
    

    <!-- Pie de página -->
    <div class="footer">
        Laboratorio Clínico OMYLAB - Todos los derechos reservados
    </div>
</body>
</html>
